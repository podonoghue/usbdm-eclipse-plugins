<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>USBDM: usb_implementation_composite.h</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">USBDM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">usb_implementation_composite.h</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * @file     usb_implementation_composite.h</span></div><div class="line"><span class="comment"> * @brief    USB Composite device implementation</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This module provides an implementation of a USB Composite interface</span></div><div class="line"><span class="comment"> * including the following end points:</span></div><div class="line"><span class="comment"> *  - EP0 Standard control</span></div><div class="line"><span class="comment"> *  - EP1 Bulk OUT</span></div><div class="line"><span class="comment"> *  - EP2 Bulk IN</span></div><div class="line"><span class="comment"> *  - EP3 Interrupt CDC notification</span></div><div class="line"><span class="comment"> *  - EP4 CDC data OUT</span></div><div class="line"><span class="comment"> *  - EP5 CDC data IN</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @version  V4.12.1.170</span></div><div class="line"><span class="comment"> * @date     2 April 2017</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> *  This file provides the implementation specific code for the USB interface.</span></div><div class="line"><span class="comment"> *  It will need to be modified to suit an application.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="preprocessor">#ifndef PROJECT_HEADERS_USB_IMPLEMENTATION_COMPOSITE_H_</span></div><div class="line"><span class="preprocessor">#define PROJECT_HEADERS_USB_IMPLEMENTATION_COMPOSITE_H_</span></div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Under Windows 8, or 10 there is no need to install a driver for</span></div><div class="line"><span class="comment"> * the bulk end-points if the MS_COMPATIBLE_ID_FEATURE is enabled.</span></div><div class="line"><span class="comment"> * winusb.sys driver will be automatically loaded.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Under Windows 10 the usbser.sys driver will be loaded automatically</span></div><div class="line"><span class="comment"> * for the CDC (serial) interface</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Under Linux drivers for bulk and CDC are automatically loaded</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="preprocessor">#define MS_COMPATIBLE_ID_FEATURE</span></div><div class="line"><span class="preprocessor">#include &quot;usb_cdc_interface.h&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define UNIQUE_ID</span></div><div class="line"><span class="comment">//#include &quot;configure.h&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">namespace </span><a class="code" href="namespace_u_s_b_d_m.html">USBDM</a> {</div><div class="line"></div><div class="line"><span class="comment">//======================================================================</span></div><div class="line"><span class="comment">// Customise for each USB device</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/** Causes a semi-unique serial number to be generated for each USB device */</span></div><div class="line"><span class="preprocessor">#define UNIQUE_ID</span></div><div class="line"></div><div class="line"><span class="preprocessor">#ifndef SERIAL_NO</span></div><div class="line"><span class="preprocessor">#ifdef UNIQUE_ID</span></div><div class="line"><span class="preprocessor">#define SERIAL_NO           &quot;USBDM-%lu&quot;</span></div><div class="line"><span class="preprocessor">#else</span></div><div class="line"><span class="preprocessor">#define SERIAL_NO           &quot;USBDM-0001&quot;</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#ifndef PRODUCT_DESCRIPTION</span></div><div class="line"><span class="preprocessor">#define PRODUCT_DESCRIPTION &quot;USB-Test&quot;</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#ifndef MANUFACTURER</span></div><div class="line"><span class="preprocessor">#define MANUFACTURER        &quot;pgo&quot;</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="preprocessor">#ifndef VENDOR_ID</span></div><div class="line"><span class="preprocessor">#define VENDOR_ID  (0x16D0)</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#ifndef PRODUCT_ID</span></div><div class="line"><span class="preprocessor">#define PRODUCT_ID (0xFFFF)</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">#ifndef VERSION_ID</span></div><div class="line"><span class="preprocessor">#define VERSION_ID (0x0100)</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="comment">//======================================================================</span></div><div class="line"><span class="comment">// Maximum packet sizes for each endpoint</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="keyword">static</span> constexpr uint  CONTROL_EP_MAXSIZE           = 64; <span class="comment">//!&lt; Control in/out</span></div><div class="line"><span class="comment"></span><span class="comment">/*</span></div><div class="line"><span class="comment"> *  TODO Define additional end-point sizes</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> constexpr uint  BULK_OUT_EP_MAXSIZE          = 64; <span class="comment">//!&lt; Bulk out</span></div><div class="line"><span class="comment"></span><span class="keyword">static</span> constexpr uint  BULK_IN_EP_MAXSIZE           = 64; <span class="comment">//!&lt; Bulk in</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="keyword">static</span> constexpr uint  CDC_NOTIFICATION_EP_MAXSIZE  = 16; <span class="comment">//!&lt; CDC notification</span></div><div class="line"><span class="comment"></span><span class="keyword">static</span> constexpr uint  CDC_DATA_OUT_EP_MAXSIZE      = 16; <span class="comment">//!&lt; CDC data out</span></div><div class="line"><span class="comment"></span><span class="keyword">static</span> constexpr uint  CDC_DATA_IN_EP_MAXSIZE       = 16; <span class="comment">//!&lt; CDC data in</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="preprocessor">#ifdef USBDM_USB0_IS_DEFINED</span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Class representing USB0</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">class </span>Usb0 : <span class="keyword">public</span> <a name="a0"></a><a class="code" href="namespace_u_s_b_d_m.html#ad575062af796ee44ea4cb8ddcb5bb091">UsbBase_T</a>&lt;Usb0Info, CONTROL_EP_MAXSIZE&gt; {</div><div class="line"></div><div class="line">   <span class="keyword">friend</span> UsbBase_T&lt;Usb0Info, CONTROL_EP_MAXSIZE&gt;;</div><div class="line"></div><div class="line"><span class="keyword">public</span>:<span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * String indexes</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * Must agree with stringDescriptors[] order</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">enum</span> StringIds {<span class="comment"></span></div><div class="line"><span class="comment">      /** Language information for string descriptors */</span></div><div class="line">      s_language_index=0,    <span class="comment">// Must be zero</span><span class="comment"></span></div><div class="line"><span class="comment">      /** Manufacturer */</span></div><div class="line">      s_manufacturer_index,<span class="comment"></span></div><div class="line"><span class="comment">      /** Product Description */</span></div><div class="line">      s_product_index,<span class="comment"></span></div><div class="line"><span class="comment">      /** Serial Number */</span></div><div class="line">      s_serial_index,<span class="comment"></span></div><div class="line"><span class="comment">      /** Configuration Index */</span></div><div class="line">      s_config_index,</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">      /** Name of Bulk interface */</span></div><div class="line">      s_bulk_interface_index,</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">      /** Name of CDC interface */</span></div><div class="line">      s_cdc_interface_index,<span class="comment"></span></div><div class="line"><span class="comment">      /** CDC Control Interface */</span></div><div class="line">      s_cdc_control_interface_index,<span class="comment"></span></div><div class="line"><span class="comment">      /** CDC Data Interface */</span></div><div class="line">      s_cdc_data_Interface_index,</div><div class="line">      <span class="comment">/*</span></div><div class="line"><span class="comment">       * TODO Add additional String indexes</span></div><div class="line"><span class="comment">       */</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">      /** Marks last entry */</span></div><div class="line">      s_number_of_string_descriptors</div><div class="line">   };</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Endpoint numbers\n</span></div><div class="line"><span class="comment">    * Must be consecutive</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">enum</span> EndpointNumbers {<span class="comment"></span></div><div class="line"><span class="comment">      /** USB Control endpoint number - must be zero */</span></div><div class="line">      CONTROL_ENDPOINT  = 0,</div><div class="line"></div><div class="line">      <span class="comment">/* end-points are assumed consecutive */</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">      /** Bulk out endpoint number */</span></div><div class="line">      BULK_OUT_ENDPOINT,<span class="comment"></span></div><div class="line"><span class="comment">      /** Bulk in endpoint number */</span></div><div class="line">      BULK_IN_ENDPOINT,</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">      /** CDC Control endpoint number */</span></div><div class="line">      CDC_NOTIFICATION_ENDPOINT,<span class="comment"></span></div><div class="line"><span class="comment">      /** CDC Data out endpoint number */</span></div><div class="line">      CDC_DATA_OUT_ENDPOINT,<span class="comment"></span></div><div class="line"><span class="comment">      /** CDC Data in endpoint number */</span></div><div class="line">      CDC_DATA_IN_ENDPOINT,</div><div class="line"></div><div class="line">      <span class="comment">/*</span></div><div class="line"><span class="comment">       * TODO Add additional Endpoint numbers here</span></div><div class="line"><span class="comment">       */</span><span class="comment"></span></div><div class="line"><span class="comment">      /** Total number of end-points */</span></div><div class="line">      NUMBER_OF_ENDPOINTS,</div><div class="line">   };</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Configuration numbers, consecutive from 1</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">enum</span> Configurations {</div><div class="line">      CONFIGURATION_NUM = 1,</div><div class="line">      <span class="comment">/*</span></div><div class="line"><span class="comment">       * Assumes single configuration</span></div><div class="line"><span class="comment">       */</span><span class="comment"></span></div><div class="line"><span class="comment">      /** Total number of configurations */</span></div><div class="line">      NUMBER_OF_CONFIGURATIONS = CONFIGURATION_NUM,</div><div class="line">   };</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * String descriptor table</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> uint8_t *<span class="keyword">const</span> stringDescriptors[];</div><div class="line"></div><div class="line"><span class="keyword">protected</span>:</div><div class="line">   <span class="comment">/* end-points */</span></div><div class="line">   <span class="comment"></span></div><div class="line"><span class="comment">   /** Out end-point for Bulk */</span></div><div class="line">   <span class="keyword">static</span> OutEndpoint &lt;Usb0Info, Usb0::BULK_OUT_ENDPOINT, BULK_OUT_EP_MAXSIZE&gt; epBulkOut;</div><div class="line">   <span class="comment"></span></div><div class="line"><span class="comment">   /** In end-point for Bulk */</span></div><div class="line">   <span class="keyword">static</span> InEndpoint  &lt;Usb0Info, Usb0::BULK_IN_ENDPOINT,  BULK_IN_EP_MAXSIZE&gt;  epBulkIn;</div><div class="line">   <span class="comment"></span></div><div class="line"><span class="comment">   /** In end-point for CDC notifications */</span></div><div class="line">   <span class="keyword">static</span> InEndpoint  &lt;Usb0Info, Usb0::CDC_NOTIFICATION_ENDPOINT, CDC_NOTIFICATION_EP_MAXSIZE&gt;  epCdcNotification;</div><div class="line">   <span class="comment"></span></div><div class="line"><span class="comment">   /** Out end-point for CDC data out */</span></div><div class="line">   <span class="keyword">static</span> OutEndpoint &lt;Usb0Info, Usb0::CDC_DATA_OUT_ENDPOINT,     CDC_DATA_OUT_EP_MAXSIZE&gt;      epCdcDataOut;</div><div class="line">   <span class="comment"></span></div><div class="line"><span class="comment">   /** In end-point for CDC data in */</span></div><div class="line">   <span class="keyword">static</span> InEndpoint  &lt;Usb0Info, Usb0::CDC_DATA_IN_ENDPOINT,      CDC_DATA_IN_EP_MAXSIZE&gt;       epCdcDataIn;</div><div class="line">   <span class="comment">/*</span></div><div class="line"><span class="comment">    * TODO Add additional End-points here</span></div><div class="line"><span class="comment">    */</span></div><div class="line"></div><div class="line">   <span class="keyword">using</span> cdcInterface = USBDM::CDC_Interface;</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Initialise the USB0 interface</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    *  @note Assumes clock set up for USB operation (48MHz)</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> <span class="keywordtype">void</span> initialise();</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    *  Blocking transmission of data over bulk IN end-point</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    *  @param size   Number of bytes to send</span></div><div class="line"><span class="comment">    *  @param buffer Pointer to bytes to send</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    *  @note : Waits for idle BEFORE transmission but\n</span></div><div class="line"><span class="comment">    *  returns before data has been transmitted</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> <span class="keywordtype">void</span> sendBulkData(<span class="keyword">const</span> uint8_t size, <span class="keyword">const</span> uint8_t *buffer);</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    *  Blocking reception of data over bulk OUT end-point</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    *   @param maxSize Maximum number of bytes to receive</span></div><div class="line"><span class="comment">    *   @param buffer  Pointer to buffer for bytes received</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    *   @return Number of bytes received</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    *   @note Doesn&#39;t return until command has been received.</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> <span class="keywordtype">int</span> receiveBulkData(uint8_t maxSize, uint8_t *buffer);</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * CDC Transmit</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * @param data Pointer to data to transmit</span></div><div class="line"><span class="comment">    * @param size Number of bytes to transmit</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> <span class="keywordtype">void</span> sendCdcData(<span class="keyword">const</span> uint8_t *data, <span class="keywordtype">unsigned</span> size);</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * CDC Receive</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * @param data    Pointer to data to receive</span></div><div class="line"><span class="comment">    * @param maxSize Maximum number of bytes to receive</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * @return Number of bytes received</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> <span class="keywordtype">int</span> receiveCdcData(uint8_t *data, <span class="keywordtype">unsigned</span> maxSize);</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Notify IN (device-&gt;host) endpoint that data is available</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * @return Not used</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> <span class="keywordtype">bool</span> notify();</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Device Descriptor</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> <a name="_a1"></a><a class="code" href="struct_device_descriptor.html">DeviceDescriptor</a> deviceDescriptor;</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Other descriptors type</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">struct </span>Descriptors {</div><div class="line">      <a name="_a2"></a><a class="code" href="struct_configuration_descriptor.html">ConfigurationDescriptor</a>                  configDescriptor;</div><div class="line"></div><div class="line">      <a name="_a3"></a><a class="code" href="struct_interface_descriptor.html">InterfaceDescriptor</a>                      bulk_interface;</div><div class="line">      <a name="_a4"></a><a class="code" href="struct_endpoint_descriptor.html">EndpointDescriptor</a>                       bulk_out_endpoint;</div><div class="line">      <a class="code" href="struct_endpoint_descriptor.html">EndpointDescriptor</a>                       bulk_in_endpoint;</div><div class="line"></div><div class="line">      <a name="_a5"></a><a class="code" href="struct_interface_association_descriptor.html">InterfaceAssociationDescriptor</a>           interfaceAssociationDescriptorCDC;</div><div class="line">      <a class="code" href="struct_interface_descriptor.html">InterfaceDescriptor</a>                      cdc_CCI_Interface;</div><div class="line">      <a name="_a6"></a><a class="code" href="struct_c_d_c_header_functional_descriptor.html">CDCHeaderFunctionalDescriptor</a>            cdc_Functional_Header;</div><div class="line">      <a name="_a7"></a><a class="code" href="struct_c_d_c_call_management_functional_descriptor.html">CDCCallManagementFunctionalDescriptor</a>    cdc_CallManagement;</div><div class="line">      <a name="_a8"></a><a class="code" href="struct_c_d_c_abstract_control_management_descriptor.html">CDCAbstractControlManagementDescriptor</a>   cdc_Functional_ACM;</div><div class="line">      <a name="_a9"></a><a class="code" href="struct_c_d_c_union_functional_descriptor.html">CDCUnionFunctionalDescriptor</a>             cdc_Functional_Union;</div><div class="line">      <a class="code" href="struct_endpoint_descriptor.html">EndpointDescriptor</a>                       cdc_notification_Endpoint;</div><div class="line"></div><div class="line">      <a class="code" href="struct_interface_descriptor.html">InterfaceDescriptor</a>                      cdc_DCI_Interface;</div><div class="line">      <a class="code" href="struct_endpoint_descriptor.html">EndpointDescriptor</a>                       cdc_dataOut_Endpoint;</div><div class="line">      <a class="code" href="struct_endpoint_descriptor.html">EndpointDescriptor</a>                       cdc_dataIn_Endpoint;</div><div class="line">      <span class="comment">/*</span></div><div class="line"><span class="comment">       * TODO Add additional Descriptors here</span></div><div class="line"><span class="comment">       */</span></div><div class="line">   };</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * All other descriptors</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> Descriptors otherDescriptors;</div><div class="line"></div><div class="line"><span class="keyword">protected</span>:<span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Initialises all end-points</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> <span class="keywordtype">void</span> initialiseEndpoints(<span class="keywordtype">void</span>) {</div><div class="line">      epBulkOut.initialise();</div><div class="line">      addEndpoint(&amp;epBulkOut);</div><div class="line">      epBulkOut.setCallback(bulkOutTransactionCallback);</div><div class="line"></div><div class="line">      epBulkIn.initialise();</div><div class="line">      addEndpoint(&amp;epBulkIn);</div><div class="line">      epBulkIn.setCallback(bulkInTransactionCallback);</div><div class="line">      </div><div class="line">      epCdcNotification.initialise();</div><div class="line">      addEndpoint(&amp;epCdcNotification);</div><div class="line"></div><div class="line">      epCdcDataOut.initialise();</div><div class="line">      addEndpoint(&amp;epCdcDataOut);</div><div class="line">      epCdcDataOut.setCallback(cdcOutTransactionCallback);</div><div class="line"></div><div class="line">      <span class="comment">// Make sure epCdcDataOut is ready for polling (OUT)</span></div><div class="line">      epCdcDataOut.startRxTransaction(<a name="a10"></a><a class="code" href="namespace_u_s_b_d_m.html#a124f63fb6f98bc31674386e28e12dacda0f056f12ece9450fe381e8ea569e2581">EPDataOut</a>, epCdcDataOut.BUFFER_SIZE);</div><div class="line"></div><div class="line">      epCdcDataIn.initialise();</div><div class="line">      addEndpoint(&amp;epCdcDataIn);</div><div class="line">      epCdcDataIn.setCallback(cdcInTransactionCallback);</div><div class="line"></div><div class="line">      <span class="comment">// Start CDC status transmission</span></div><div class="line">      epCdcSendNotification();</div><div class="line"></div><div class="line">      <span class="comment">// Connect notify callback</span></div><div class="line">      cdcInterface::setUsbInNotifyCallback(notify);</div><div class="line">      <span class="comment">/*</span></div><div class="line"><span class="comment">       * TODO Initialise additional End-points here</span></div><div class="line"><span class="comment">       */</span></div><div class="line">   }</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Callback for SOF tokens</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> <span class="keywordtype">void</span> sofCallback();</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Call-back handling BULK-OUT transaction complete</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> <span class="keywordtype">void</span> bulkOutTransactionCallback(<a name="a11"></a><a class="code" href="namespace_u_s_b_d_m.html#a124f63fb6f98bc31674386e28e12dacd">EndpointState</a> state);</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Call-back handling BULK-IN transaction complete</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> <span class="keywordtype">void</span> bulkInTransactionCallback(<a class="code" href="namespace_u_s_b_d_m.html#a124f63fb6f98bc31674386e28e12dacd">EndpointState</a> state);</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Call-back handling CDC-IN transaction complete\n</span></div><div class="line"><span class="comment">    * Checks for data and schedules transfer as necessary\n</span></div><div class="line"><span class="comment">    * Each transfer will have a ZLP as necessary.</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * @param state Current end-point state</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> <span class="keywordtype">void</span> cdcInTransactionCallback(<a class="code" href="namespace_u_s_b_d_m.html#a124f63fb6f98bc31674386e28e12dacd">EndpointState</a> state);</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Call-back handling CDC-OUT transaction complete\n</span></div><div class="line"><span class="comment">    * Data received is passed to the cdcInterface</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * @param state Current end-point state</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> <span class="keywordtype">void</span> cdcOutTransactionCallback(<a class="code" href="namespace_u_s_b_d_m.html#a124f63fb6f98bc31674386e28e12dacd">EndpointState</a> state);</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Handler for Token Complete USB interrupts for\n</span></div><div class="line"><span class="comment">    * end-points other than EP0</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> <span class="keywordtype">void</span> handleTokenComplete(<span class="keywordtype">void</span>);</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Start CDC IN transaction\n</span></div><div class="line"><span class="comment">    * A packet is only sent if data is available</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> <span class="keywordtype">void</span> startCdcIn();</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Configure epCdcNotification for an IN transaction [Tx, device -&gt; host, DATA0/1]</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> <span class="keywordtype">void</span> epCdcSendNotification();</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Handle SETUP requests not handled by base handler</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * @param setup SETUP packet received from host</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * @note Provides CDC extensions</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> <span class="keywordtype">void</span> handleUserEp0SetupRequests(<span class="keyword">const</span> <a name="_a12"></a><a class="code" href="struct_setup_packet.html">SetupPacket</a> &amp;setup);</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * CDC Set line coding handler</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> <span class="keywordtype">void</span> handleSetLineCoding();</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * CDC Get line coding handler</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> <span class="keywordtype">void</span> handleGetLineCoding();</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * CDC Set line state handler</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> <span class="keywordtype">void</span> handleSetControlLineState();</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * CDC Send break handler</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">static</span> <span class="keywordtype">void</span> handleSendBreak();</div><div class="line"></div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">using</span> UsbImplementation = Usb0;</div><div class="line"></div><div class="line"><span class="preprocessor">#endif // USBDM_USB0_IS_DEFINED</span></div><div class="line"></div><div class="line">} <span class="comment">// End namespace USBDM</span></div><div class="line"></div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* PROJECT_HEADERS_USB_IMPLEMENTATION_COMPOSITE_H_ */</span><span class="preprocessor"></span></div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Aug 12 2017 08:54:36 for USBDM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
