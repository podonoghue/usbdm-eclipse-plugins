<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>USBDM: mag3310.h</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">USBDM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">mag3310.h</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> ============================================================================</span></div><div class="line"><span class="comment"> * @file     mag3310.h</span></div><div class="line"><span class="comment"> * @brief    Interface for MAG3310 3-axis magnetometer</span></div><div class="line"><span class="comment"> * @version  V4.11.1.70</span></div><div class="line"><span class="comment"> * @date     18 June 2015</span></div><div class="line"><span class="comment"> * @author   podonoghue</span></div><div class="line"><span class="comment"> ============================================================================</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="preprocessor">#ifndef INCLUDE_USBDM_MAG3310_H_</span></div><div class="line"><span class="preprocessor">#define INCLUDE_USBDM_MAG3310_H_</span></div><div class="line"> <span class="comment">/*</span></div><div class="line"><span class="comment"> * *****************************</span></div><div class="line"><span class="comment"> * *** DO NOT EDIT THIS FILE ***</span></div><div class="line"><span class="comment"> * *****************************</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This file is generated automatically.</span></div><div class="line"><span class="comment"> * Any manual changes will be lost.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="preprocessor">#include &lt;stdint.h&gt;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="i2c_8h.html">i2c.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">namespace </span><a class="code" href="namespace_u_s_b_d_m.html">USBDM</a> {</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * @addtogroup MAG3310_Group MAG3310 3-axis magnetometer</span></div><div class="line"><span class="comment"> * @brief C++ Class allowing interface to MAG3310</span></div><div class="line"><span class="comment"> * @{</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define MAG3310_CTRL_REG1_AC_MASK             (1&lt;&lt;0) // Operating mode 0=&gt;STANDBY mode, 1=&gt;ACTIVE mode.</span></div><div class="line"><span class="preprocessor">#define MAG3310_CTRL_REG1_TM_MASK             (1&lt;&lt;1) // Trigger immediate measurement</span></div><div class="line"><span class="preprocessor">#define MAG3310_CTRL_REG1_FR_MASK             (1&lt;&lt;2) // Fast Read selection 0=&gt; 16-bit values, 1=&gt;Only MSB are read</span></div><div class="line"><span class="preprocessor">#define MAG3310_CTRL_REG1_OS_OFF              (3)    // This register configures the over sampling ratio for the measurement</span></div><div class="line"><span class="preprocessor">#define MAG3310_CTRL_REG1_OS_MASK             (0x3&lt;&lt;MAG3310_CTRL_REG1_OS_OFF)</span></div><div class="line"><span class="preprocessor">#define MAG3310_CTRL_REG1_OS(x)               (((x)&lt;&lt;MAG3310_CTRL_REG1_OS_OFF)&amp;MAG3310_CTRL_REG1_OS_MASK)</span></div><div class="line"><span class="preprocessor">#define MAG3310_CTRL_REG1_OS_16               (MAG3310_CTRL_REG1_OS(0))</span></div><div class="line"><span class="preprocessor">#define MAG3310_CTRL_REG1_OS_32               (MAG3310_CTRL_REG1_OS(1))</span></div><div class="line"><span class="preprocessor">#define MAG3310_CTRL_REG1_OS_64               (MAG3310_CTRL_REG1_OS(2))</span></div><div class="line"><span class="preprocessor">#define MAG3310_CTRL_REG1_OS_128              (MAG3310_CTRL_REG1_OS(3))</span></div><div class="line"><span class="preprocessor">#define MAG3310_CTRL_REG1_OS(x)               (((x)&lt;&lt;MAG3310_CTRL_REG1_OS_OFF)&amp;MAG3310_CTRL_REG1_OS_MASK)</span></div><div class="line"><span class="preprocessor">#define MAG3310_CTRL_REG1_OS(x)               (((x)&lt;&lt;MAG3310_CTRL_REG1_OS_OFF)&amp;MAG3310_CTRL_REG1_OS_MASK)</span></div><div class="line"><span class="preprocessor">#define MAG3310_CTRL_REG1_OS(x)               (((x)&lt;&lt;MAG3310_CTRL_REG1_OS_OFF)&amp;MAG3310_CTRL_REG1_OS_MASK)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define MAG3310_CTRL_REG1_DR_OFF              (5)    // Output data rate selection</span></div><div class="line"><span class="preprocessor">#define MAG3310_CTRL_REG1_DR_MASK             (0x7&lt;&lt;MAG3310_CTRL_REG1_DR_OFF)</span></div><div class="line"><span class="preprocessor">#define MAG3310_CTRL_REG1_DR(x)               (((x)&lt;&lt;MAG3310_CTRL_REG1_DR_OFF)&amp;MAG3310_CTRL_REG1_DR_MASK)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define MAG3310_CTRL_REG2_MAG_RST_MASK        (1&lt;&lt;4)</span></div><div class="line"><span class="preprocessor">#define MAG3310_CTRL_REG2_RAW_MASK            (1&lt;&lt;5)</span></div><div class="line"><span class="preprocessor">#define MAG3310_CTRL_REG2_AUTO_MRST_EN_MASK   (1&lt;&lt;7)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define MAG3310_DR_STATUS_XDR_MASK            (1&lt;&lt;0) // X-axis new Data Available</span></div><div class="line"><span class="preprocessor">#define MAG3310_DR_STATUS_YDR_MASK            (1&lt;&lt;1) // Y-axis new Data Available</span></div><div class="line"><span class="preprocessor">#define MAG3310_DR_STATUS_ZDR_MASK            (1&lt;&lt;2) // Z-axis new Data Available</span></div><div class="line"><span class="preprocessor">#define MAG3310_DR_STATUS_XYZDR_MASK          (1&lt;&lt;3) // X or Y or Z-axis new Data Available</span></div><div class="line"><span class="preprocessor">#define MAG3310_DR_STATUS_XOW_MASK            (1&lt;&lt;4) // X-axis Data Overwrite</span></div><div class="line"><span class="preprocessor">#define MAG3310_DR_STATUS_YOW_MASK            (1&lt;&lt;5) // Y-axis Data Overwrite</span></div><div class="line"><span class="preprocessor">#define MAG3310_DR_STATUS_ZOW_MASK            (1&lt;&lt;6) // Z-axis Data Overwrite</span></div><div class="line"><span class="preprocessor">#define MAG3310_DR_STATUS_ZYXOW_MASK          (1&lt;&lt;7) // ZYX-axis Data Overwrite</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define MAG3310_SYSMOD_SYSMOD_OFF              (5)</span></div><div class="line"><span class="preprocessor">#define MAG3310_SYSMOD_SYSMOD_MASK             (0x7&lt;&lt;MAG3310_SYSMOD_SYSMOD_OFF)</span></div><div class="line"><span class="preprocessor">#define MAG3310_SYSMOD_SYSMOD(x)               (((x)&lt;&lt;MAG3310_SYSMOD_SYSMOD_OFF)&amp;MAG3310_SYSMOD_SYSMOD_MASK)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define MAG3310_XYZ_DATA_CFG_FS(x)          (((x)&lt;&lt;0)&amp;0x03)</span></div><div class="line"><span class="preprocessor">#define MAG3310_XYZ_DATA_CFG_HPF_OUT_MASK   (1&lt;&lt;4)</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * @brief Class representing an interface for MAG3310 3-axis magnetometer over I2C</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * &lt;b&gt;Example&lt;/b&gt;</span></div><div class="line"><span class="comment"> * @code</span></div><div class="line"><span class="comment"> *  // Instantiate interface</span></div><div class="line"><span class="comment"> *  I2c     *i2c   = new I2C_0();</span></div><div class="line"><span class="comment"> *  MAG3310 *magnetometer = new MAG3310(i2c);</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> *  int      status;</span></div><div class="line"><span class="comment"> *  int16_t  x, y, z;</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> *  magnetometer-&gt;readMagnetometerXYZ(&amp;status, &amp;x, &amp;y, &amp;z);</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @endcode</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">class </span>MAG3310 {</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">   <a name="_a0"></a><a class="code" href="class_u_s_b_d_m_1_1_i2c.html">USBDM::I2c</a> &amp;i2c;</div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> uint8_t  DEVICE_ADDRESS = 0x0E&lt;&lt;1;</div><div class="line">   <span class="keyword">static</span> <span class="keyword">const</span> uint8_t  WHO_AM_I_VALUE = 0xC4;</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Read Accelerometer register</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * @param[in] regNum Register number</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   uint8_t readReg(uint8_t regNum);<span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Write Accelerometer register</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * @param[in] regNum  Register number</span></div><div class="line"><span class="comment">    * @param[in] value   Value to write</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keywordtype">void</span>    writeReg(uint8_t regNum, uint8_t value);<span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Reset Accelerometer</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keywordtype">void</span>    reset(<span class="keywordtype">void</span>);</div><div class="line">   <span class="keywordtype">bool</span>    failedInit;</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line"></div><div class="line">   <span class="keyword">struct </span>Data {</div><div class="line">      uint8_t magnetometerStatus;</div><div class="line">      uint8_t magnetometer_X;</div><div class="line">      uint8_t magnetometer_Y;</div><div class="line">      uint8_t magnetometer_Z;</div><div class="line">   };</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Constructor</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * @param[in] i2c The I2C interface to use</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   MAG3310(<a class="code" href="class_u_s_b_d_m_1_1_i2c.html">USBDM::I2c</a> &amp;i2c);<span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Put accelerometer into Standby mode</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keywordtype">void</span> standby();<span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Put accelerometer into Active mode</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keywordtype">void</span> active();<span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Obtains measurements from the Magnetometer</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * @param[out] status  Indicates status of x, y &amp; z measurements</span></div><div class="line"><span class="comment">    * @param[out] x       X axis value</span></div><div class="line"><span class="comment">    * @param[out] y       Y axis value</span></div><div class="line"><span class="comment">    * @param[out] z       Z axis value</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keywordtype">void</span> readMagnetometerXYZ(<span class="keywordtype">int</span> &amp;status, int16_t &amp;x, int16_t &amp;y, int16_t &amp;z);</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Read ID from accelerometer</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * @return ID value as 8-bit number (0x1A for MMA8451Q)</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   uint32_t readID();<span class="comment"></span></div><div class="line"><span class="comment">   /**</span></div><div class="line"><span class="comment">    * Simple calibration of magnetometer</span></div><div class="line"><span class="comment">    * Requires user to rotate the board in all dimensions</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keywordtype">void</span> calibrateMagnetometer();</div><div class="line"></div><div class="line">};</div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * @}</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line">} <span class="comment">// End namespace USBDM</span></div><div class="line"></div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* INCLUDE_USBDM_MAG3310_H_ */</span><span class="preprocessor"></span></div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Aug 12 2017 08:54:36 for USBDM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
